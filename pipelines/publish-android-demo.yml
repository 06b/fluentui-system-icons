# Copyright (c) Microsoft Corporation.
# Licensed under the MIT license.

steps:
- task: UseNode@1
  inputs:
    version: '11.x'

- task: Npm@1
  displayName: Run npm install
  inputs:
    command: 'install'
    workingDir: 'importer'

- task: Npm@1
  displayName: Run generate script
  inputs:
    command: 'custom'
    workingDir: 'importer'
    customCommand: 'run deploy:android'

- task: DownloadSecureFile@1
  displayName: 'Get Keystore'
  name: keystore
  inputs:
    secureFile: 'debug.keystore'

- task: Gradle@2
  displayName: Gradle build demo app
  inputs:
    gradleWrapperFile: 'android/gradlew'
    workingDirectory: 'android'
    options: '-DversionName=$(Build.BuildNumber) -DversionCode=$(Build.BuildNumber) -DvstsAccessToken=$(System.AccessToken) -Pandroid.injected.signing.store.file=$(keystore.secureFilePath) -Pandroid.injected.signing.store.password=$(store.password) -Pandroid.injected.signing.key.alias=$(key.alias) -Pandroid.injected.signing.key.password=$(key.password)'
    tasks: ':sample-showcase:assembleRelease'
    publishJUnitResults: false
    javaHomeOption: 'JDKVersion'
    sonarQubeRunAnalysis: false

- task: AppCenterDistribute@3
  displayName: Publish demo app to App Center
  inputs:
    serverEndpoint: 'Fluent mobile icons demo'
    appSlug: 'Fluent-Design-Mobile/Fluent-Mobile-Icons-Demo'
    appFile: 'android/sample-showcase/build/outputs/apk/release/sample-showcase-release.apk'
    symbolsOption: 'Android'
    releaseNotesOption: 'input'
    releaseNotesInput: 'Please enjoy this latest version of Fluent Mobile Icons Demo.'
    destinationType: 'groups'
    distributionGroupId: '11111111-1111-1111-1111-111111111111'